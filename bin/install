#!/bin/sh

# This asdf shell script installs ConTeXt

echo cp -R $ASDF_DOWNLOAD_PATH/* $ASDF_INSTALL_PATH
cp -R $ASDF_DOWNLOAD_PATH/* $ASDF_INSTALL_PATH

echo "--------------------------------------------"

echo $ASDF_DOWNLOAD_PATH
ls -la $ASDF_DOWNLOAD_PATH
echo "--------------------------------------------"

echo $ASDF_INSTALL_PATH
ls -la $ASDF_INSTALL_PATH
echo "--------------------------------------------"

cd $ASDF_INSTALL_PATH

sh ./install.sh

rm -rf ./bin

CONTEXT_BIN_DIR=$(find $ASDF_INSTALL_PATH -iname bin)

mkdir -p bin

for cmd in `ls $CONTEXT_BIN_DIR` ; do
  case $cmd in
    *.lua)
      ;;
    *)
    cat <<END_TEMPLATE > bin/$cmd
#!/usr/bin/env bash
# asdf-context-plugin: $cmd
exec $CONTEXT_BIN_DIR/$cmd \$@
END_TEMPLATE

    chmod a+x bin/$cmd
  esac
done

echo "------------------------------------------------------------------"
echo "asdf-context:"
echo ""
echo "The asdf now manages the context commands."
echo ""
echo "The context commands should now simply work...."
echo ""